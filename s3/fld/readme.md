
# Idea is:

### Simply make fluentd tail a log file, where log file can be generated by any tool like logback etc.
### Then configure a <source> to tail the log file
### important is the tag-name in source 
### then configure <match tag-name> where type is s3
### Asumptions: are that EC2 machine itself is in an IAM role that has write access to S3 
#### or else we need to provide credentitals in match tag, not a good idea
## installing S3 plug in for fluentd 
### since fluentd is a ruby app include s3 in gem file then do bundle install

~~~~ 
source 'https://rubygems.org'
gem 'io-console'
gem 'fluentd', '0.12.25'
gem 'fluent-plugin-record-reformer', '0.8.1'
gem 'fluent-plugin-kinesis','1.0.1'
gem 'fluent-plugin-typecast','0.2.0' 
gem 'fluent-plugin-s3'
~~~~

then in aws cloud formation yml
~~~~ 
LaunchConfig:
    Type: AWS::AutoScaling::LaunchConfiguration
      AWS::CloudFormation::Init:
        configSets:
          service_configuration:
          - ajit_fluentd_config
        ajit_fluentd_config:
          files:
            /opt/fluentd/conf.d/service.conf: #this is the remote path
              content: '@file://./localFluentd/fluentd.conf'
            /opt/fluentd/Gemfile: # this is the remote path file name
              content: '@file://./localFluentd/fluentdGemFile'
          commands:
            bundle_install:
              cwd: "/opt/fluentd"
              command: "/usr/local/bin/bundle install"
            start_fluentd:
              command: '/sbin/initctl start fluentd'
~~~~ 
